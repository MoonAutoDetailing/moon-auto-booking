<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Book a Detail</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #f5f7fb;
      margin: 0;
      padding: 40px;
    }

    .card {
      max-width: 520px;
      margin: auto;
      background: #fff;
      padding: 30px;
      border-radius: 14px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.08);
    }

    h1 {
      text-align: center;
      color: #4f8de6;
      margin-bottom: 25px;
    }

    label {
      display: block;
      font-weight: 600;
      margin-top: 16px;
      margin-bottom: 6px;
    }

    input, select {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #d6dbe3;
      font-size: 15px;
    }

    button {
      margin-top: 24px;
      width: 100%;
      padding: 14px;
      background: #4f8de6;
      border: none;
      color: white;
      font-size: 16px;
      border-radius: 10px;
      cursor: pointer;
    }

    button:hover {
      background: #3e7bd6;
    }
  </style>
</head>

<body>
  <div class="card">
    <h1>Book a Detail</h1>

    <label>Full Name</label>
    <input id="fullName" />

    <label>Email</label>
    <input id="email" />

    <label>Phone</label>
    <input id="phone" />

    <label>Service Address</label>
    <input id="address" />

    <label>Vehicle Year</label>
    <input id="vehicleYear" type="number" />

    <label>Vehicle Make</label>
    <input id="vehicleMake" />

    <label>Vehicle Model</label>
    <input id="vehicleModel" />

    <label>Vehicle Size</label>
    <select id="vehicleSize">
      <option value="">Select size</option>
      <option value="compact">Compact</option>
      <option value="midsized">Midsized</option>
      <option value="oversized">Oversized</option>
    </select>

    <label>License Plate</label>
    <input id="licensePlate" />

    <label>Select Service</label>
    <select id="serviceSelect" disabled>
      <option value="">Select vehicle size first</option>
    </select>

    <label>Start</label>
    <input id="startTime" type="datetime-local" />

    <label>End</label>
    <input id="endTime" type="datetime-local" />

    <button>Submit Booking</button>
  </div>

<script>
  const supabase = window.supabase.createClient(
    "https://lhwlvleocakggpbbpzyx.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxod2x2bGVvY2FrZ2dwYmJwenl4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA0NTQwMDksImV4cCI6MjA4NjAzMDAwOX0.VXGGO7KCqWmcpXOFrlpPT92WmZMxe8xpNNytAsdjURI"
  );

  const vehicleSizeSelect = document.getElementById("vehicleSize");
  const serviceSelect = document.getElementById("serviceSelect");

  vehicleSizeSelect.addEventListener("change", loadServices);

  async function loadServices() {
    const size = vehicleSizeSelect.value;

    serviceSelect.innerHTML = "";
    serviceSelect.disabled = true;

    if (!size) {
      serviceSelect.innerHTML = `<option>Select vehicle size first</option>`;
      return;
    }

    const { data, error } = await supabase
      .from("service_variants")
      .select(`
        id,
        price,
        duration_minutes,
        services:service_id (
          category,
          level
        )
      `)
      .eq("vehicle_size", size)
      .eq("active", true)
      .order("services(category)", { ascending: true });

    if (error || !data.length) {
      serviceSelect.innerHTML = `<option>No services available</option>`;
      return;
    }

    serviceSelect.innerHTML = `<option value="">Select a service</option>`;

    data.forEach(row => {
      const label = `${row.services.category} â€“ Level ${row.services.level} ($${row.price})`;
      const option = document.createElement("option");
      option.value = row.id;
      option.textContent = label;
      serviceSelect.appendChild(option);
    });

    serviceSelect.disabled = false;
  }
</script>
</body>
</html>
