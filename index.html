<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Moon Auto Detailing â€“ Book Now</title>

  <!-- Supabase JS v2 -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root{
      --moon-blue:#4f8de6;
      --bg:#f5f7fb;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --border:#d6dbe3;
      --shadow: 0 10px 25px rgba(0,0,0,0.08);
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
      background:var(--bg);
      color:var(--text);
    }
    .topbar{
      background:#0b0b0b;
      height:70px;
      display:flex;
      align-items:center;
      justify-content:flex-end;
      padding:0 18px;
    }
    .topbar img{ height:44px; }
    .wrap{ padding:34px 16px 60px; }
    .card{
      max-width:560px;
      margin:0 auto;
      background:#fff;
      border-radius:14px;
      box-shadow:var(--shadow);
      padding:28px;
    }
    h1{
      text-align:center;
      color:var(--moon-blue);
      font-size:42px;
      margin-bottom:22px;
    }
    label{
      font-weight:700;
      display:block;
      margin:16px 0 8px;
    }
    input, select{
      width:100%;
      padding:12px;
      border-radius:10px;
      border:1px solid var(--border);
      font-size:15px;
    }
    .row{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
    }
    .btn{
      margin-top:22px;
      padding:14px;
      border-radius:12px;
      border:none;
      background:var(--moon-blue);
      color:#fff;
      font-size:16px;
      font-weight:800;
      cursor:pointer;
    }
    .status{
      margin-top:14px;
      font-size:14px;
      color:var(--muted);
      white-space:pre-wrap;
    }
  </style>
</head>

<body>
  <div class="topbar">
    <img src="NewLogoColor.png" alt="Moon Auto Detailing" />
  </div>

  <div class="wrap">
    <div class="card">
      <h1>Book a Detail</h1>

      <form id="booking-form">
        <label>Full Name</label>
        <input id="fullName" required />

        <label>Email</label>
        <input id="email" type="email" required />

        <label>Phone</label>
        <input id="phone" required />

        <label>Service Address</label>
        <input id="address" required />

        <div class="row">
          <div>
            <label>Vehicle Year</label>
            <input id="vehicleYear" type="number" required />
          </div>
          <div>
            <label>License Plate</label>
            <input id="licensePlate" required />
          </div>
        </div>

        <div class="row">
          <div>
            <label>Vehicle Make</label>
            <input id="vehicleMake" required />
          </div>
          <div>
            <label>Vehicle Model</label>
            <input id="vehicleModel" required />
          </div>
        </div>

        <label>Vehicle Size</label>
        <select id="vehicleSize" required>
          <option value="">Select size</option>
          <option value="compact">compact</option>
          <option value="midsized">midsized</option>
          <option value="oversized">oversized</option>
        </select>

        <label>Select Service</label>
        <select id="serviceSelect" disabled required>
          <option value="">Select vehicle size first</option>
        </select>

        <button class="btn">Submit Booking</button>
        <div id="status" class="status"></div>
      </form>
    </div>
  </div>

<script>
const supabaseClient = supabase.createClient(
  "https://lhwlvleocakggpbbpzyx.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxod2x2bGVvY2FrZ2dwYmJwenl4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA0NTQwMDksImV4cCI6MjA4NjAzMDAwOX0.VXGGO7KCqWmcpXOFrlpPT92WmZMxe8xpNNytAsdjURI"
);

const vehicleSizeEl = document.getElementById("vehicleSize");
const serviceSelectEl = document.getElementById("serviceSelect");
const statusEl = document.getElementById("status");

vehicleSizeEl.addEventListener("change", loadServices);

async function loadServices() {
  serviceSelectEl.disabled = true;
  serviceSelectEl.innerHTML = "";

  const size = vehicleSizeEl.value;
  if (!size) return;

  const { data, error } = await supabaseClient
    .from("service_variants")
    .select(`
      id,
      price,
      duration_minutes,
      services (
        category,
        level
      )
    `)
    .eq("vehicle_size", size)
    .eq("active", true);

  if (error) {
    statusEl.textContent = error.message;
    return;
  }

  serviceSelectEl.innerHTML = `<option value="">Select service</option>`;

  data.forEach(r => {
    if (!r.services) return; // ðŸ”’ guard against bad FK rows

    const opt = document.createElement("option");
    opt.value = r.id;
    opt.textContent =
      `${r.services.category} â€“ Level ${r.services.level} ($${r.price}) â€¢ ${r.duration_minutes} min`;
    serviceSelectEl.appendChild(opt);
  });

  serviceSelectEl.disabled = false;
}
</script>
</body>
</html>
